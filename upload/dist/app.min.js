/*!
 * PrintPixel - A shopping cart for printing custom products
 * Version: 1.0 - December 2014
 * Author: ExpressPixel
 * Website: http://expresspixel.com/
 *
 *
 * Copyright 2012, 2015 ExpressPixel.com
 *
 */
"use strict";function getBorderColor(e){var t=tinycolor(e);return t.isDark()?"#FFFFFF":"#000000"}function show_indicator(){$(".loading-indicator").show()}function hide_indicator(){$(".loading-indicator").hide()}function isVML(){return"undefined"!=typeof G_vmlCanvasManager}function showLayerChoice(){setTimeout(function(){$("#layer-choice").show()},300)}function deleteObject(){$("#layer-choice").hide(),$.confirm({text:"Are you sure you want to delete this item?",confirm:function(){var e=angular.element(document.getElementById("designer-controller")).scope();e.canvas.remove(e.canvas.getActiveObject()),e.drawCanvas(),e.saveCanvas(),e.editableItem=null,"$apply"!==e.$root.$$phase&&"$digest"!==e.$root.$$phase&&e.$apply()},cancel:function(){}})}function stripeResponseHandler(e,t){console.log("stripeResponseHandler",e,t)}function openCustomWindow(e){var t=1024,a=768,n=screen.width/2-t/2,o=screen.height/2-a/2;if("undefined"==typeof customWindow||customWindow.closed)customWindow=window.open(e,"customOpener","width="+t+",height="+a+",location=1,resizable=1,scrollbars=1,status=1, top="+o+",left="+n,!0),customWindow.focus();else if("undefined"==typeof customWindow||customWindow.closed)customWindow=window.open(e,"customOpener","width="+t+",height="+a+",location=1,resizable=1,scrollbars=1,status=1, top="+o+",left="+n,!0);else{try{customWindow.document}catch(i){customWindow=window.open(e,"customOpener","width="+t+",height="+a+",location=1,resizable=1,scrollbars=1,status=1, top="+o+",left="+n,!0),customWindow.focus()}"Microsoft Internet Explorer"==navigator.appName?(customWindow.close(),customWindow=window.open(e,"customOpener","width="+t+",height="+a+",location=1,resizable=1,scrollbars=1,status=1, top="+o+",left="+n,!0),customWindow.focus()):customWindow.focus()}}!function(e){var t,a,n,o,i,r=e.body,c=e.createElement("div");c.innerHTML='<span style="'+["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;")+'">'+Array(100).join("wi")+"</span>",c=c.firstChild,t=function(e){return c.style.fontFamily=e,r.appendChild(c),i=c.clientWidth,r.removeChild(c),i},a=t("monospace"),n=t("serif"),o=t("sans-serif"),window.isFontAvailable=function(e){return a!==t(e+",monospace")||o!==t(e+",sans-serif")||n!==t(e+",serif")}}(document),window.performance=window.performance||{},performance.now=function(){return performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||Date.now}(),String.prototype.shorten=String.prototype.trunc||function(e){return this.length>e?this.substr(0,e-1)+"...":this};var canvas=null,canvasContainerX=0,canvasContainerY=0;!function(){$("#cart .heading").bind("click",function(){return $("#cart").toggleClass("active"),!1}),$(document).click(function(e){-1==$(e.target).parents().index($("#cart"))&&$("#cart").is(":visible")&&$("#cart").removeClass("active")}),$("#designer-product").click(function(e){-1==$(e.target).parents().index($("#designer-container"))&&-1==$(e.target).parents().index($("#layer-choice"))&&canvas.deactivateAllWithDispatch().renderAll()}),$("#layer-choice").hide(),$("#designer-product").draggable({cancel:"canvas"}),$("#designer-product").draggable("disable"),$("#designer-product").click(function(e){var t=$(this).offset();canvasContainerX=e.pageX-t.left,canvasContainerY=e.pageY-t.top,-1==$(e.target).parents().index($("#layer-choice"))&&($("#layer-choice").hide(),$("#layer-choice").css({top:e.pageY+10+"px",left:e.pageX+"px"}))}),canvas=new fabric.Canvas("designer-canvas"),canvas.selection=!1,canvas.on("selection:cleared",function(){var e=angular.element(document.getElementById("designer-controller")).scope();e.editMode="none",e.canvas=canvas,"$apply"!==e.$root.$$phase&&"$digest"!==e.$root.$$phase&&e.$apply()}),canvas.on("mouse:down",function(e){var t=angular.element(document.getElementById("designer-controller")).scope(),a=e.target;"undefined"!=typeof a&&("i-text"===a.type||"text"===a.type?(t.editMode="text",t.$apply()):(t.editMode="image",t.$apply()))}),canvas.on("mouse:over",function(e){var t=canvas.getObjects().indexOf(e.target),a=canvas.getObjects().indexOf(canvas.getActiveObject());e.target.setShadow(t!=a?"1px 1px 1px rgba(102, 153, 255, 1)":""),canvas.renderAll()}),canvas.on("mouse:out",function(e){e.target.setShadow(""),canvas.renderAll()}),canvas.on("object:selected",function(e){var t=angular.element(document.getElementById("designer-controller")).scope(),a=e.target,n=canvas.getObjects().indexOf(canvas.getActiveObject());a.setShadow(""),canvas.getActiveObject().set({borderColor:"rgba(102, 153, 255, 1)",borderWidth:10,hasRotatingPoint:!1,cornerSize:12,borderOpacityWhenMoving:1}),t.editableItem=n,t.editable.angle=a.angle;var o=a.angle;if(a.angle>360&&(o-=360),0>o&&(o+=360),o=parseInt(o),$("#rotation-image").val(o).trigger("change"),$("#rotation-text").val(o).trigger("change"),"i-text"===a.type||"text"===a.type){t.editMode="text",t.editable.text=a.getText(),t.editable.textAlign=a.getTextAlign(),t.editable.fill=a.getFill(),t.editable.stroke=a.getStroke(),t.editable.strokeWidth=20*a.getStrokeWidth(),t.editable.fontName=a.get("fontName");var i=a.fontSize*a.scaleX;a.setFontSize(parseInt(i,10)),a.setScaleX(1),a.setScaleY(1),t.editable.fontSize=a.fontSize;var r=a.getFontWeight();t.editable.bold="bold"==r?!0:!1;var c=a.getFontStyle();t.editable.italic="italic"==c?!0:!1}else t.editable.type=a.type,t.editable.original_colors=a.original_colors,t.editable.paths=a.paths,t.editable.stroke=a.getStroke(),t.editable.strokeWidth=20*a.getStrokeWidth(),t.editMode="image";"$apply"!==t.$root.$$phase&&"$digest"!==t.$root.$$phase&&t.$apply()}),canvas.on("object:scaling",function(){$("#layer-choice").hide()}),canvas.on("object:moving",function(){$("#layer-choice").hide()}),canvas.on("object:rotating",function(e){$("#layer-choice").hide();var t=e.target,a=(angular.element(document.getElementById("designer-controller")).scope(),canvas.getObjects().indexOf(canvas.getActiveObject()),t.angle);t.angle>360&&(a-=360),0>a&&(a+=360),a=parseInt(a),$("#rotation-image").val(a).trigger("update"),$("#rotation-text").val(a).trigger("update")}),canvas.on("object:modified",function(e){var t=e.target,a=angular.element(document.getElementById("designer-controller")).scope(),n=canvas.getObjects().indexOf(canvas.getActiveObject());t.setShadow(""),a.editableItem=n,a.canvas=canvas,a.saveCanvas();var o=t.angle;if(t.angle>360&&(o-=360),0>o&&(o+=360),o=parseInt(o),a.editable.angle=o,$("#rotation-image").val(o).trigger("change"),$("#rotation-text").val(o).trigger("change"),"i-text"===t.type||"text"===t.type){a.editMode="text",a.editable.text=t.getText(),a.editable.textAlign=t.getTextAlign(),a.editable.fill=t.getFill(),a.editable.stroke=t.getStroke(),a.editable.strokeWidth=20*t.getStrokeWidth(),a.editable.fontName=t.get("fontName");var i=t.fontSize*t.scaleX;t.setFontSize(parseInt(i,10)),t.setScaleX(1),t.setScaleY(1),a.editable.fontSize=t.fontSize;var r=t.getFontWeight();a.editable.bold="bold"==r?!0:!1;var c=t.getFontStyle();a.editable.italic="italic"==c?!0:!1,a.$apply()}else a.editMode="image",a.$apply()}),angular.module("app",["ui.router","ui.bootstrap","ui.slider","rzModule","templatescache","simplecolorpicker","imgpreload","perfect_scrollbar","angularFileUpload","ngSanitize","LocalStorageModule","angularSpectrumColorpicker","ui.spinner","countrySelect","gettext"]),angular.module("app").constant("_",window._),angular.module("app").run(["gettextCatalog","ApiService",function(e,t){e.loadRemote(t.Url("get_language.php"))}]),angular.module("app").filter("range",function(){return function(e,t){t=parseInt(t);for(var a=0;t>a;a++)e.push(a);return e}}),angular.module("app").config(["$httpProvider",function(e){e.defaults.withCredentials=!0,e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"]}])}();var topLeftImage=new Image;topLeftImage.src="css/images/fa_times.png";var topRightImage=new Image;topRightImage.src="css/images/fa_rotate.png";var bottomRightImage=new Image;bottomRightImage.src="css/images/fa_resize.png";var bottomLeftImage=new Image;bottomLeftImage.src="css/images/fa_layers.png",fabric.Object.prototype._drawControl=function(e,t,a,n,o){var i=this.cornerSize;this.isControlVisible(e)&&(isVML()||this.transparentCorners||t.clearRect(n,o,i,i),t.strokeStyle="rgba(102, 153, 255, 0.5)",t.lineWidth=1,"tl"==e?(t.drawImage(topLeftImage,n,o,i,i),t.strokeRect(n,o,i,i)):"tr"==e?(t.drawImage(topRightImage,n,o,i,i),t.strokeRect(n,o,i,i)):"bl"==e?(t.drawImage(bottomLeftImage,n,o,i,i),t.strokeRect(n,o,i,i)):"br"==e&&(t.drawImage(bottomRightImage,n,o,i,i),t.strokeRect(n,o,i,i)))},fabric.Canvas.prototype._getActionFromCorner=function(e,t){var a="drag";return t&&(a="ml"===t||"mr"===t?"scaleX":"mt"===t||"mb"===t?"scaleY":"tl"===t?"rotate":"scale","tr"==t&&(a="rotate"),"tl"==t&&(a="delete",deleteObject()),"bl"==t&&(a="layer",showLayerChoice(e.top,e.left))),a},fabric.Canvas.prototype._handleCursorAndEvent=function(e,t){this._setCursorFromEvent(e,t);var a=this;setTimeout(function(){a._setCursorFromEvent(e,t)},50),this.fire("mouse:up",{target:t,e:e}),t&&t.fire("mouseup",{e:e})},fabric.Canvas.prototype._getRotatedCornerCursor=function(e,t){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7};if("tr"==e)return"copy";if("tl"==e)return"pointer";if("bl"==e)return"pointer";var n=Math.round(t.getAngle()%360/45);return 0>n&&(n+=8),n+=a[e],n%=8,this.cursorMap[n]},angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/home"),e.state("app",{url:"",views:{"":{templateUrl:"viewer.html","abstract":!0},edit_text:{templateUrl:"text.edit.html",controller:"TextEditController"},edit_image:{templateUrl:"images.edit.html",controller:"ImagesEditController"}}}).state("app.home",{url:"/home",templateUrl:"home.html"}).state("app.product",{url:"/product","abstract":!0,templateUrl:"viewer.html",controller:"ProductController"}).state("app.product.home",{url:"/home",templateUrl:"product.home.html"}).state("app.product.selection",{url:"/selection/:productSlug/:variantSlug",controller:"ProductSelectionController"}).state("app.product.browser",{url:"/browser",templateUrl:"product.home.html",onEnter:["$stateParams","$state","$modal",function(e,t,a){a.open({templateUrl:"product.browser.html",backdrop:!1,size:"lg",resolve:{},controller:"ProductBrowserController"}).result.then(function(e){return e?t.transitionTo("items"):void 0})}]}).state("app.images",{url:"/images","abstract":!0,templateUrl:"image.html",controller:"ImagesController"}).state("app.images.home",{url:"/home",templateUrl:"images.home.html"}).state("app.images.clip-art",{url:"/clip-art",templateUrl:"images.clip-art.html",controller:"ImagesGraphicsController"}).state("app.images.add-graphic",{url:"/add-graphic/*path",controller:"ImagesAddGraphicController"}).state("app.images.upload",{url:"/upload",templateUrl:"images.upload.html",controller:"ImagesUploadController"}).state("app.images.my-images",{url:"/my-images",templateUrl:"images.my-images.html",controller:"ImagesBoxController"}).state("app.images.edit",{url:"/edit",templateUrl:"images.edit.html",controller:"ImagesEditController"}).state("app.text",{url:"/text","abstract":!0,templateUrl:"viewer.html",controller:"TextController"}).state("app.text.add",{url:"/add",templateUrl:"text.add.html"}).state("app.text.edit",{url:"/edit",templateUrl:"text.edit.html",controller:"TextEditController"}).state("app.buy",{url:"/buy","abstract":!0,templateUrl:"viewer.html",controller:"BuyController"}).state("app.buy.home",{url:"/home",templateUrl:"buy.home.html"})}]),angular.module("ui.spinner",[]).value("uiSpinnerConfig",{}).directive("uiSpinner",["uiSpinnerConfig","$timeout",function(e,t){return e=e||{},{require:"ngModel",compile:function(){return function(a,n,o,i){function r(e,t){return t?parseFloat(e):parseInt(e)}function c(){n.spinner("destroy")}var s=angular.extend(a.$eval(o.uiSpinner)||{},e),l={min:null,max:null},d=["min","max","step","start","numberFormat","mouseWheel"],u=angular.isUndefined(o.useDecimals)?!1:!0,m=function(){angular.forEach(d,function(e){angular.isDefined(o[e])&&(s[e]=r(o[e],u))}),s.mouseWheel=!1,n.spinner(s),m=angular.noop};angular.forEach(d,function(e){o.$observe(e,function(t){t&&(m(),n.spinner("option",e,r(t,u)),i.$render())})}),o.$observe("disabled",function(e){m(),n.spinner("option","disabled",!!e)}),a.$watch(o.uiSpinner,function(e){m(),void 0!=e&&n.spinner("option",e)},!0),t(m,0,!0),n.bind("spin",function(e,t){i.$setViewValue(t.values||t.value),a.$apply()}),i.$render=function(){m();var e=s.range===!0?"values":"value";s.range||!isNaN(i.$viewValue)||i.$viewValue instanceof Array?s.range&&!angular.isDefined(i.$viewValue)&&(i.$viewValue=[0,0]):i.$viewValue=0,s.range===!0&&(angular.isDefined(s.min)&&s.min>i.$viewValue[0]&&(i.$viewValue[0]=s.min),angular.isDefined(s.max)&&s.max<i.$viewValue[1]&&(i.$viewValue[1]=s.max),i.$viewValue[0]>i.$viewValue[1]&&(l.min>=i.$viewValue[1]&&(i.$viewValue[0]=l.min),l.max<=i.$viewValue[0]&&(i.$viewValue[1]=l.max)),l.min=i.$viewValue[0],l.max=i.$viewValue[1]),n.spinner(e,i.$viewValue)},a.$watch(o.ngModel,function(){s.range===!0&&i.$render()},!0),n.bind("$destroy",c)}}}}]);var app=angular.module("simplecolorpicker",[]);app.directive("scpButton",function(){var e="&nbsp;&nbsp;&nbsp;&nbsp;";return{restrict:"E",template:'<div  title="{{titleText || color.name}}" style="background-color: {{color.value}}" ng-class="getClass()" ng-click="clicked()" role="button" tabindex="0">'+e+"</div>",replace:!0,scope:{titleText:"=",color:"=scpColor","class":"@class",currentColor:"=scpCurrentColor"},link:function(e,t){e.clicked=function(){t.hasClass("button")&&e.$parent.selectColor(e.color)},e.getClass=function(){return e.currentColor==e.color&&"selected"||""}}}}),app.directive("simplecolorpicker",function(){return{restrict:"E",template:'<span class="simplecolorpicker inline" ng-show="picker"><scp-button class="simplecolorpicker icon" scp-color="currentColor"></scp-button></span><span ng-class="getClass()"><scp-button class="simplecolorpicker button" ng-repeat="color in colors" scp-current-color="currentColor" scp-color="color"></scp-button></span>',replace:!1,scope:{colors:"=scpColors",currentColor:"=scpColor",picker:"=scpPicker",model:"="},link:function(e,t,a){var n=t.find(".icon"),o=function(){var e=t.find(".picker"),a=16,o=n.position();e.css({left:o.left+n.width()/2-a,top:o.top+n.outerHeight()}),e.show()},i=function(){var e=t.find(".picker");e.is(":visible")&&e.hide()},r=function(e){e.stopPropagation(),e.preventDefault()};$(document).on("mousedown",i),n.on("mousedown",o),$(t).on("mousedown",".picker, .icon",r),e.$watch("picker",function(e){0==e&&t.find(".colors").show()}),e.getClass=function(){return["simplecolorpicker","colors",e.picker&&"picker"||"inline"]},e.selectColor=function(t){e.currentColor=t,e.model[a.scpColor]=t}}}});var app=angular.module("imgpreload",[]);app.directive("spinnerOnLoad",function(){return{restrict:"A",link:function(e,t){t.on("load",function(){t.removeClass("spinner-hide"),t.addClass("spinner-show"),t.parent().find("span").remove()}),e.$watch("ngSrc",function(){t.addClass("spinner-hide"),t.parent().append('<span class="spinner"></span>')})}}}),angular.module("app").controller("BuyCheckoutController",["$scope","$location","$urlRouter","$stateParams","$http","ApiService","PriceService","$state","CanvasService","ProductService","CartService","localStorageService","stripe_publishable_key","currency_code","settings","$modal","$modalInstance","$rootScope","$window","$q",function(e,t,a,n,o,i,r,c,s,l,d,u,m,p,g,h,f,v,b,y){this.name="BuyCheckoutController",this.params=n,e.totalPrice=0,e.orderId=0,e.zoom=75/460,e.customer_details={},e.checkout_details={},e.settings=g,e.selectedCountry={},e.postageTypes=null,e.postageOption=0,e.PriceService=r,e.ProductService=l,e.CartService=d,e.localStorageService=u,e.stripe_publishable_key=m,e.currency_code=p,e.purchase=!1,e.word=/^[a-z0-9\-\s]+$/i,e.countries=[{name:"Afghanistan",code:"AF"},{name:"Åland Islands",code:"AX"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"Andorra",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antarctica",code:"AQ"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia",code:"BO"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Bouvet Island",code:"BV"},{name:"Brazil",code:"BR"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Christmas Island",code:"CX"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo",code:"CG"},{name:"Congo, The Democratic Republic of the",code:"CD"},{name:"Cook Islands",code:"CK"},{name:"Costa Rica",code:"CR"},{name:"Cote D'Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Falkland Islands (Malvinas)",code:"FK"},{name:"Faroe Islands",code:"FO"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"French Polynesia",code:"PF"},{name:"French Southern Territories",code:"TF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greece",code:"GR"},{name:"Greenland",code:"GL"},{name:"Grenada",code:"GD"},{name:"Guadeloupe",code:"GP"},{name:"Guam",code:"GU"},{name:"Guatemala",code:"GT"},{name:"Guernsey",code:"GG"},{name:"Guinea",code:"GN"},{name:"Guinea-Bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Heard Island and Mcdonald Islands",code:"HM"},{name:"Holy See (Vatican City State)",code:"VA"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Isle of Man",code:"IM"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jersey",code:"JE"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kiribati",code:"KI"},{name:"Korea, Democratic People's Republic of",code:"KP"},{name:"Korea, Republic of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Lao People's Democratic Republic",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libyan Arab Jamahiriya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Macedonia, The Former Yugoslav Republic of",code:"MK"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Marshall Islands",code:"MH"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mayotte",code:"YT"},{name:"Mexico",code:"MX"},{name:"Micronesia, Federated States of",code:"FM"},{name:"Moldova, Republic of",code:"MD"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montserrat",code:"MS"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nauru",code:"NR"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"Netherlands Antilles",code:"AN"},{name:"New Caledonia",code:"NC"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"Niue",code:"NU"},{name:"Norfolk Island",code:"NF"},{name:"Northern Mariana Islands",code:"MP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Pitcairn",code:"PN"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saint Helena",code:"SH"},{name:"Saint Kitts and Nevis",code:"KN"},{name:"Saint Lucia",code:"LC"},{name:"Saint Pierre and Miquelon",code:"PM"},{name:"Saint Vincent and the Grenadines",code:"VC"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Sao Tome and Principe",code:"ST"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia and Montenegro",code:"CS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Solomon Islands",code:"SB"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Georgia and the South Sandwich Islands",code:"GS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Svalbard and Jan Mayen",code:"SJ"},{name:"Swaziland",code:"SZ"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syrian Arab Republic",code:"SY"},{name:"Taiwan, Province of China",code:"TW"},{name:"Tajikistan",code:"TJ"},{name:"Tanzania, United Republic of",code:"TZ"},{name:"Thailand",code:"TH"},{name:"Timor-Leste",code:"TL"},{name:"Togo",code:"TG"},{name:"Tokelau",code:"TK"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Turks and Caicos Islands",code:"TC"},{name:"Tuvalu",code:"TV"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vanuatu",code:"VU"},{name:"Venezuela",code:"VE"},{name:"Vietnam",code:"VN"},{name:"Virgin Islands, British",code:"VG"},{name:"Virgin Islands, U.S.",code:"VI"},{name:"Wallis and Futuna",code:"WF"},{name:"Western Sahara",code:"EH"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}],window.scope=e,window.scopeCheckout=e,e.$watchCollection("customer_details",function(){u.set("customer_details",e.customer_details)}),e.$watch("postageOption",function(t){r.setPostage(t),e.postageOption=t}),e.imageUrl=function(e){return i.imageUrl(e)},e.getCheckoutDetails=function(){var t=d.getItems();e.totalPrice=d.getTotalPrice(),e.checkout_details.title=t.length+" items",e.checkout_details.quantity=t.length,e.checkout_details.price=accounting.formatMoney(d.sumTotalPrice(),r.getCurrencySymbol()),e.checkout_details.amount=e.totalPrice,e.checkout_details.description=t.length+" items",e.checkout_details.postage=r.getPostage(),e.checkout_details.currency=r.getCurrency(),e.checkout_details.postage_description=r.getPostageDescription(),e.checkout_details.items=t,console.log("checkout_details",e.checkout_details)},e.calcTotalPrice=function(){var t=accounting.unformat(e.checkout_details.price);return null!=e.postageTypes&&(t+=accounting.unformat(e.postageTypes[e.postageOption].price)),e.formatMoney(t)},e.sumQuantities=function(e){var t=_.reduce(e,function(e,t){return t=parseInt(t),e+t},0);return t},e.formatMoney=function(e){return accounting.formatMoney(e,r.getCurrencySymbol())},e.dismiss=function(){e.$dismiss()},e.calcLeft=function(e,t){return-e/2+t/2},e.handlePaypalToken=function(t){show_indicator(),o({method:"POST",url:i.Url("paypal/checkout_confirm.php"),data:{token:t,orderId:e.orderId},cache:!1}).success(function(t){e.order=t,f.close(!0),hide_indicator();h.open({templateUrl:"buy.confirmation.html",controller:"BuyConfirmationController",backdrop:!0,size:"lg",resolve:{order:function(){return e.order}}})}).error(function(){})},e.handleConfirmation=function(t){show_indicator(),o({method:"POST",url:i.Url("checkout.php"),data:t,cache:!1}).success(function(t){e.order=t,f.close(!0),hide_indicator();h.open({templateUrl:"buy.confirmation.html",controller:"BuyConfirmationController",backdrop:!0,size:"lg",resolve:{order:function(){return e.order}}})}).error(function(){})},e.handleCustomPayment=function(t){var a={};a.orderId=t,e.handleConfirmation(a)},e.handleStripeToken=function(t,a){var n={};n.token=t,n.args=a,n.orderId=e.orderId,e.handleConfirmation(n)},e.saving=!1,e.selectedMethod=null,e.showMethodChoices=function(){var t=h.open({templateUrl:"buy.payment-method.html",controller:"BuyPaymentMethodController",backdrop:!0,size:"md",resolve:{paymentMethods:function(){return e.settings.paymentMethods}}});t.result.then(function(t){e.selectedMethod=t,e.startPayment()},function(){console.log("Modal dismissed at: "+new Date)})},e.submitForm=function(t){console.log("isValid",t),t&&(_.size(e.settings.paymentMethods)>1?e.showMethodChoices():e.startPayment())},e.preCheckout=function(){var t=y.defer(),a={};return a.customer_details=e.customer_details,a.amount=d.getTotalPrice(),a.cart=d.getItems(),a.checkout_details=e.checkout_details,a.postage=r.getPostage(),a.payment_method=e.selectedMethod,console.log("postage",a.amount,a.postage,e.postageOption),e.saving=!0,o({method:"POST",url:i.Url("checkout_pre.php"),data:a,cache:!1}).success(function(a){e.orderId=a.order.id,e.saving=!1,t.resolve(a)}).error(function(a){e.saving=!1,t.reject(a)}),t.promise},e.startPayment=function(){"stripe"!=e.selectedMethod&&"bank_transfer"!=e.selectedMethod&&openCustomWindow(i.Url("processors/please_wait.html")),e.preCheckout().then(function(t){if("stripe"==t.order.payment_method)e.stripeHandler.open({email:e.customer_details.email,name:e.site_name,description:e.checkout_details.title,amount:accounting.toFixed(100*t.order.amount),currency:r.getCurrency()});else if("bank_transfer"==t.order.payment_method){var a={};a.orderId=e.orderId,e.handleConfirmation(a)}else{var n=i.Url("processors/"+t.order.payment_method+"/start.php?id="+e.orderId),o=e.getPaymentMethodInfo(t.order.payment_method);if(customWindow&&!customWindow.closed)customWindow.focus(),customWindow.location.href=n;else{h.open({scope:e,templateUrl:"buy.custom.html",controller:"BuyCustomController",backdrop:!0,size:"sm",resolve:{title:function(){return o.name},customUrl:function(){return n}}})}}})},e.stripeHandler=null,e.init=function(){e.postageOption=r.getPostage(),e.customer_details.country=_.find(e.countries,{code:"GB"});var t=u.get("customer_details");if(null!=t&&(e.customer_details=t,console.log(e.customer_details.country),angular.isUndefined(e.customer_details.country.code)||(e.customer_details.country=_.find(e.countries,{code:e.customer_details.country.code}))),o({method:"GET",url:i.Url("get_pricing.php"),cache:!1}).success(function(t){e.pricing=t.pricing,e.postageTypes=t.delivery_types,console.log(t)}).error(function(){}),e.selectedMethod=_.first(e.settings.paymentMethods).slug,_.indexOf(_.pluck(e.settings.paymentMethods,"slug"),"stripe")>-1){var a=e.getPaymentMethodInfo("stripe");e.stripeHandler=StripeCheckout.configure({key:a.publishable_key,image:"https://stripe.com/img/documentation/checkout/marketplace.png",token:function(t,a){e.handleStripeToken(t,a)}})}e.getCheckoutDetails()},e.getPaymentMethodInfo=function(e){return _.findWhere(scopeCheckout.settings.paymentMethods,{slug:e})},e.init()}]);var customWindow;angular.module("app").controller("BuyConfirmationController",["$scope","$state","CartService","order",function(e,t,a,n){this.name="BuyConfirmationController",window.scope=e,window.state=t,e.order=n,e.dismiss=function(){e.$dismiss()},e.init=function(){t.go("app.home")},e.init()}]),angular.module("app").controller("BuyController",["$scope","$location","$urlRouter","$stateParams","localStorageService","$http","ApiService","PriceService","$modal","CanvasService","CartService",function(e,t,a,n,o,i,r,c,s,l,d){this.name="BuyController",this.params=n,e.quantities={},e.pricing={},e.sizeRows=0,e.deliveryTypes={},e.postageOption=0,e.CanvasService=l,e.CartService=d,e.setActiveTab("buy"),window.scope=e,e.reCalculatePrice=function(){e.totalPrice=d.sumTotalPrice()},e.addToCart=function(){var t={};t.id=d.cartId,t.quantities=e.quantities,t.price=e.calculateSinglePrice(),t.name=e.currentItem.product.name,t.thumb=1,t.meta={},d.insert(t),e.openCart()},e.$watchCollection("quantities",function(){e.storeQuantities()}),e.screenPrint=function(){if(!e.isReady)return"";var t="";return _.each(e.layers.orientations_layers,function(e){_.size(e.fills)>0&&(t+=_.size(e.fills)+" color "+e.name.toLowerCase(),t+=", ")}),t=t.substring(0,t.length-2),e.isReady&&(c.setDescription(t),c.setTitle(e.currentItem.product.name)),t},e.sumQuantities=function(e){var t=_.reduce(e,function(e,t){return t=parseInt(t),e+t},0);return t},e.sumPrice=function(t,a){var n=e.sumQuantities(t);a=accounting.unformat(a);var a=a*n;return accounting.formatMoney(a,c.getCurrencySymbol())},e.formatMoney=function(t){return accounting.formatMoney(t,e.currency)},e.storeQuantities=function(){c.setQuantities(e.quantities)},e.preInit=function(){e.quantities=c.getQuantities()},e.init=function(){e.postageOption=c.getPostage(),e.quantities=c.getQuantities(),i({method:"GET",url:r.Url("get_pricing.php"),cache:!1}).success(function(t){e.pricing=t.pricing,e.deliveryTypes=t.delivery_types}).error(function(){});var t=c.getQuantities();e.sizeRows=Math.ceil(12/_.size(e.currentItem.product.sizes)),e.isMobile&&(e.sizeRows=Math.ceil(24/_.size(e.currentItem.product.sizes))),_.each(e.currentItem.product.sizes,function(a){e.quantities[a]=t&&!angular.isUndefined(t[a])?t[a]:0})},e.openCheckout=function(){e.openCart()},e.$watch("isReady",function(){e.isReady&&e.init()}),e.preInit()}]),angular.module("app").controller("BuyCustomController",["$scope","$window","customUrl","title",function(e,t,a,n){this.name="BuyCustomController",e.customUrl=a,e.title=n,e.launchPayment=function(){openCustomWindow(e.customUrl)}}]),angular.module("app").controller("BuyPaymentMethodController",["$scope","$state","$modalInstance","paymentMethods",function(e,t,a,n){this.name="BuyPaymentMethodController",window.scope=e,window.state=t,e.paymentMethods=n,e.selectedMethod=null,e.dismiss=function(){a.$dismiss()},e.select=function(){a.close(e.selectedMethod)},e.init=function(){console.log("$scope.paymentMethods",e.paymentMethods),e.selectedMethod=_.first(e.paymentMethods).slug},e.init()}]),angular.module("app").controller("CartController",["$scope","$rootScope","$location","$http","PriceService","$state","ProductService","CartService","ApiService","$modal",function(e,t,a,n,o,i,r,c,s,l){this.name="CartController",window.cart_scope=e,window.cart_root=t,e.images={},e.CartService=c,e.money=o,e.thumbWidth=75,e.zoom=e.thumbWidth/460,e.justAdded=!1,e.$watch("currentItem",function(){e.init()}),e.imageUrl=function(e){return s.imageUrl(e)
},e.imageDims=function(t){var a=e.thumbWidth/t.width,n={};return n.width=a*t.width,n.height=a*t.height,n.printableWidth=a*t.printable_width,n.printableHeight=a*t.printable_height,n.printableOffsetX=a*t.printable_offset_x,n.printableOffsetY=a*t.printable_offset_y,n},e.sumQuantities=function(e){return c.sumQuantities(e)},e.sumPrice=function(e,t){return c.sumPrice(e,t)},e.reCalculatePrice=function(){e.setTotalPrice(c.sumTotalPrice())},e.addNewItem=function(){r.getProducts().then(function(t){var a=_.first(t.categories),n=_.find(t.products,{slug:e.default_product});angular.isUndefined(n)&&(n=_.find(t.products,{category:a.name}));var o=_.find(n.variants,{slug:n.defaultVariant});angular.isUndefined(o)&&(o=_.first(n.variants));var r=c.newItem(n,o);c.setSelectedItem(r.id),e.items=c.getItems(),e.dismiss(),i.go("app.product.home")})},e.duplicateItem=function(e){var t=c.duplicateItem(e);c.setSelectedItem(t.id),i.go("app.product.home")},e.removeItem=function(t){c.remove(t),0==c.getItems().length&&e.addNewItem(),e.items=c.getItems(),e.reCalculatePrice()},e.switchCurrentItem=function(e){c.setSelectedItem(e)},e.dismiss=function(){$(".cartModal").hasClass("in")&&e.$dismiss(),$("#cart").removeClass("active")},e.goToCheckout=function(){e.dismiss(),console.log("$scope.settings",e.settings);var t=l.open({templateUrl:"buy.checkout.html",controller:"BuyCheckoutController",size:"lg",resolve:{stripe_publishable_key:function(){return e.stripe_publishable_key},currency_code:function(){return o.getCurrency()},settings:function(){return e.settings}}});t.result.then(function(){console.log("SUCCESS"),e.resetCart()},function(){console.log("CLOSED")})},e.init=function(){e.items=c.getItems(),e.reCalculatePrice(),$('[data-toggle="tooltip"]').tooltip({placement:"top"})},e.init()}]),angular.module("app").controller("DesignerController",["$rootScope","$stateParams","$location","$scope","$state","$http","ApiService","ProductService","CanvasService","CartService","$modal","localStorageService","PriceService","FontService","gettextCatalog",function(e,t,a,n,o,i,r,c,s,l,d,u,m,p,g){this.$state=o,this.$location=a,n.canvas=null,n.designerWidth=460,n.designerHeight=460,n.borderColor="#000000",n.zoom=1,n.loaded=0,n.activeTab="home",n.editMode="none",n.defaultFont="Alpha Echo",n.site_name="PrintPixel",n.currency_code="USD",n.currency="$",n.settings={},n.editableItem=null,n.editableObject=null,n.editable={},n.currentItem=null,n.selectedOrientation=c.getOrientation(),n.selectedOrientationDimensions={},n.selectedProductOrientations={},n.layers={},n.isReady=!1,n.totalPrice=0,window.scope=n,n.items=[],n.money=m,n.CartService=l,n.CanvasService=s,n.ProductService=c,n.localStorageService=u,n.mobileDesignerHidden=!1,n.isMobile=window.innerWidth<=480?!0:!1,n.screenWidth=window.innerWidth,n.designerLeft=0,$(window).resize(function(){n.$apply(function(){n.setViewData()})}),n.$watch("isReady",function(){n.setViewData()}),n.$watch("items",function(){n.totalPrice=l.sumTotalPrice()},!0),n.$on("$stateChangeStart",function(e,t){n.editMode="none";var a=["app.images.home","app.text.add","app.images.clip-art","app.images.upload","app.images.my-images","app.images.edit","app.buy.home"];_.indexOf(a,t.name)>-1?n.hideMobileDesigner():n.showMobileDesigner()}),n.$on("$stateChangeSuccess",function(e,t){""==t.url&&o.go("app.home")}),n.uuid=null,n.setActiveTab=function(e){n.activeTab=e},n.showMobileFooter=!0,n.toggleMobileFooter=function(){n.showMobileFooter=n.showMobileFooter?!1:!0},n.setViewData=function(){n.screenWidth=window.innerWidth,window.innerWidth<=480?(n.isMobile=!0,n.designerLeft=-(n.designerWidth-n.screenWidth)/2):(n.isMobile=!1,n.designerLeft=0)},n.hideMobileDesigner=function(){n.mobileDesignerHidden=!0},n.showMobileDesigner=function(){n.mobileDesignerHidden=!1},n.imageUrl=function(e){return r.imageUrl(e)},n.imageTransparentUrl=function(e){return r.imageTransparentUrl(e)},n.calcLeft=function(e,t){return-e/2+t/2},n.zoomOut=function(){n.zoom=n.zoom-.1,n.zoom<=1&&(n.zoom=1),n.canvas.setZoom(n.zoom),n.drawCanvas(),n.zoomCanvas()},n.zoomIn=function(){n.zoom=n.zoom+.1,n.zoom>=2&&(n.zoom=2),n.zoomCanvas()},n.zoomCanvas=function(){var e=n.zoom*n.selectedOrientationDimensions.printableWidth,t=n.zoom*n.selectedOrientationDimensions.printableHeight,a=e/n.canvas.getWidth();t=a*n.canvas.getHeight(),n.canvas.setDimensions({width:e,height:t}),n.canvas.calcOffset(),n.canvas.setZoom(n.zoom),n.drawCanvas(),$("#designer-product").draggable(1==n.zoom?"disable":"enable")},n.$watch(function(){return l.selectedItemId},function(){n.isReady&&(n.canvas.clear(),n.currentItem=l.getSelectedItem(),n.items=l.getItems(),n.setOrientation(_.findKey(n.currentItem.variant.orientations)))},!0),n.$watch(function(){return c.currentOrientation},function(){n.isReady&&(n.canvas.clear(),n.selectedOrientation=c.getOrientation(),n.updateOrientation())},!0),n.updateOrientation=function(){n.zoom=1;var e=_.find(n.currentItem.product.orientations,{name:n.selectedOrientation});if(e){var t=n.designerWidth/e.width;n.selectedOrientationDimensions.width=t*e.width,n.selectedOrientationDimensions.height=t*e.height,n.selectedOrientationDimensions.printableWidth=t*e.printable_width,n.selectedOrientationDimensions.printableHeight=t*e.printable_height,n.selectedOrientationDimensions.printableOffsetX=t*e.printable_offset_x,n.selectedOrientationDimensions.printableOffsetY=t*e.printable_offset_y;{n.canvas.getWidth(),n.canvas.getHeight()}n.canvas.setWidth(n.selectedOrientationDimensions.printableWidth),n.canvas.setHeight(n.selectedOrientationDimensions.printableHeight),n.drawCanvas()}var a=null;angular.isUndefined(n.currentItem.canvases[n.selectedOrientation])?a=n.canvas:(a=n.currentItem.canvases[n.selectedOrientation],n.canvas.loadFromJSON(a),n.zoom=1,n.zoomCanvas(),n.drawCanvas()),n.borderColor=getBorderColor(_.first(n.currentItem.variant.colors)),$("#designer-container").data("border",n.borderColor),$("#designer-container").on({mouseenter:function(){$("#designer-container").css("border-color",$("#designer-container").data("border"))},mouseleave:function(){$("#designer-container").css("border-color","transparent")}})},n.setTotalPrice=function(e){n.totalPrice=e},n.saveCanvas=function(){l.updateItemCanvas(n.selectedOrientation,n.canvas,l.selectedItemId)},n.setStackPosition=function(e){var t=canvas.getActiveObject();null!=t&&("bringToFront"==e&&t.bringToFront(),"sendBackwards"==e&&t.sendBackwards(),"bringForward"==e&&t.bringForward(),"sendToBack"==e&&t.sendToBack(),n.canvas=canvas,n.saveCanvas())},n.storeOrientation=function(){s.setOrientationDesign(n.selectedOrientation,n.canvas),l.updateItemCanvas(n.selectedOrientation,n.canvas,l.selectedItemId)},n.setOrientation=function(e){c.setOrientation(e),n.selectedOrientation=e;var t=null;angular.isUndefined(n.currentItem.canvases[n.selectedOrientation])?t=n.canvas:(t=n.currentItem.canvases[n.selectedOrientation],t=n.currentItem.canvases[n.selectedOrientation],n.canvas.loadFromJSON(t),n.zoom=1,n.zoomCanvas(),n.drawCanvas())},n.fetchSession=function(){i({method:"GET",url:r.Url("session.php"),cache:!1}).success(function(e){n.uuid=e.uuid,n.loaded<100&&(n.loaded=60)}).error(function(){})},n.changeState=function(e){o.go(e)},n.updateLocalStorage=function(){n.canvas.getObjects().length>0&&n.storeOrientation(n.selectedOrientation)},n.drawCanvas=function(){n.updateLocalStorage(),canvas=n.canvas,canvas.renderAll()},n.resetCart=function(){l.reset(),n.initCart()},n.initCart=function(){if(n.currentItem=l.getSelectedItem(),n.items=l.getItems(),_.each(n.items,function(e){var t=_.find(productData.products,{slug:e.product.slug});if(angular.isUndefined(t)&&l.remove(e.id),!angular.isUndefined(t)){var a=_.find(t.variants,{slug:e.variant.slug});angular.isUndefined(a)&&l.remove(e.id)}}),n.items=l.getItems(),0==n.items.length){var e=_.first(productData.categories),t=_.find(productData.products,{slug:n.default_product});angular.isUndefined(t)&&(t=_.find(productData.products,{category:e.name}));var a=_.find(t.variants,{slug:t.defaultVariant});angular.isUndefined(a)&&(a=_.first(t.variants)),l.newItem(t,a),n.currentItem=l.getSelectedItem()}c.setOrientation(_.findKey(n.currentItem.variant.orientations))},n.init=function(){n.loaded=30,c.getProducts().then(function(e){window.productData=e,n.site_name=e.settings.site_name,n.currency_code=e.settings.currency,n.currency=e.settings.currency_symbol,n.default_product=e.settings.default_product,n.settings=e.settings,n.settings.paymentMethods=e.payment_methods,g.setCurrentLanguage(n.settings.language),m.setCurrency(e.settings.currency),m.setCurrencySymbol(e.settings.currency_symbol),n.loaded=50,p.getFonts().then(function(){n.loaded=75,m.getPricing().then(function(){n.loaded=100,n.isReady=!0,n.initCart(),p.preloadFonts().then(function(){})})})}),n.canvas=canvas,n.fetchSession()},n.init(),n.openCart=function(){var e=d.open({templateUrl:"cart.html",controller:"CartController",windowClass:"cartModal",size:"lg",scope:n,resolve:{currentItem:function(){return n.currentItem}}});e.result.then(function(){},function(){})}}]),angular.module("app").controller("ImagesAddGraphicController",["$scope","$location","$urlRouter","$stateParams","$http","$timeout","ApiService","$state",function(e,t,a,n,o,i,r,c){this.name="ImagesAddGraphicController",this.params=n,e._=_,e.clipArt=null,e.categories=null,window.scope=e,e.setActiveTab("images"),e.addClipart=function(t){console.log(e.clipArtImage(t)),fabric.loadSVGFromURL(e.clipArtImage(t),function(t,a){e.canvas.add(new fabric.PathGroup(t,a).set({left:100,top:100})),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1));var n=.9*e.canvas.width,o=.9*e.canvas.height,i=n;a.width<n&&(i=a.width);var r=i/a.width,s=a.height*r;if(console.log("still too big"),s>o){s=o;var l=s/a.height;i=a.width*l}e.canvas.getActiveObject().set({scaleX:i/a.width,scaleY:s/a.height}).center().setCoords(),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1)),e.drawCanvas(),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1)),e.drawCanvas(),e.isMobile?(c.go("app.product.home"),e.showMobileDesigner()):c.go("app.images.clip-art")})},e.clipArtImage=function(e){return r.Url("../data/clip_art/"+e)},e.$watch("isReady",function(){e.isReady&&e.addClipart(n.path)}),e.init=function(){e.isReady&&e.addClipart(n.path)},e.init()}]),angular.module("app").controller("ImagesBoxController",["$scope","$location","$urlRouter","$stateParams","$http","$timeout","ApiService",function(e,t,a,n,o,i,r){this.name="ImagesBoxController",this.params=n,e._=_,window.scope=e,e.myImages=[],e.setActiveTab("images"),e.loadMyImages=function(){o({method:"GET",url:r.Url("my_images.php"),cache:!1}).success(function(t){e.myImages=t.images}).error(function(){})},e.init=function(){e.loadMyImages()},e.init()}]),angular.module("app").controller("ImagesController",["$scope","$location","$urlRouter","$state","$stateParams","$http","$timeout","ApiService",function(e,t,a,n,o,i,r,c){this.name="ImagesController",this.params=o,e._=_,window.scope=e,e.isHome="app.images.home"==n.name,e.setActiveTab("images"),e.$on("$stateChangeSuccess",function(t,a){e.isHome="app.images.home"==a.name}),e.uploadURL=function(e){return c.uploadURL(e)},e.addImage=function(t){fabric.Image.fromURL(t,function(t){e.canvas.add(t),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1));var a=.9*e.canvas.width,n=.9*e.canvas.height,o=a;t.width<a&&(o=t.width);var i=o/t.width,r=t.height*i;if(r>n){r=n;var c=r/t.height;o=t.width*c}e.canvas.getActiveObject().set({scaleX:o/t.width,scaleY:r/t.height}).center().setCoords(),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1)),e.drawCanvas(),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1)),e.drawCanvas()})},e.init=function(){},e.init()}]),angular.module("app").controller("ImagesEditController",["$scope","$location","$urlRouter","$stateParams","$state",function(e){e.colors=null,e.item=null,e.canvasHeight=null,e.canvasWidth=null,window.imageScope=e,e.setActiveTab("images"),e.eventColors=[{name:"Black",value:"#000000"},{name:"Green",value:"#7bd148"},{name:"BoldBlue",value:"#5484ed"},{name:"Blue",value:"#a4bdfc"},{name:"Turquoise",value:"#46d6db"},{name:"LightGreen",value:"#7ae7bf"},{name:"BoldGreen",value:"#51b749"},{name:"Yellow",value:"#fbd75b"},{name:"Orange",value:"#ffb878"},{name:"Red",value:"#ff887c"},{name:"BoldRed",value:"#dc2127"},{name:"Purple",value:"#dbadff"},{name:"Gray",value:"#e1e1e1"}],e.palette=[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],e.options={width:90,height:90,min:0,max:360,fgColor:"#428BCA",displayPrevious:!1,readOnly:!1,cursor:!0,thickness:".3"},$("#rotation-image").knob({width:90,height:90,min:-1,max:360,fgColor:"#428BCA",displayPrevious:!1,readOnly:!1,cursor:10,thickness:".3",change:function(e){var t=canvas.getActiveObject();null!=t&&(t.setAngle(e),canvas.renderAll())},release:function(e){var t=canvas.getActiveObject();null!=t&&(t.setAngle(e),canvas.renderAll())}}),e.scaleX=null,e.scaleY=null,e.scaleX_perc=null,e.scaleY_perc=null,e.angle=0,e.original_colors=null,e.outline=!1,e.strokeColor=e.eventColors[1],e.strokeWidth=20,e.$watch("editableItem",function(){if(console.log("editableItem",e.editableItem),null!=e.editableItem){var t=e.canvas.item(e.editableItem);"i-text"!=t.type&&"text"!=t.type&&e.init()}}),e.$watch("colors",function(){console.log("colors changed"),e.updateColors()},!0),e.changeStroke=function(){0==e.outline&&(e.editable.stroke=null),e.canvas.item(e.editableItem).setStroke(e.editable.stroke);var t=e.editable.strokeWidth/100;t=5*t,console.log("changeStroke",e.editable.stroke,t),e.canvas.item(e.editableItem).setStrokeWidth(t),e.drawCanvas()},e.beforeShow=function(e){console.log("beforeShow",e)},e.updateColors=function(){_.each(e.editable.original_colors,function(t,a){var n=_.find(e.colors,{original:t.fill});n&&null!=n.replacement&&(console.log("updateColors",e.editable.paths[a].fill,n.replacement),e.editable.paths[a].fill=n.replacement)});var t=e.canvas.item(e.editableItem);null!=t&&(t.set("paths",e.editable.paths),t.original_colors=e.original_colors),e.drawCanvas()},e.switchColor=function(t,a){t.replacement=a,e.updateColors()},e.flipHorizontal=function(){e.canvas.item(e.editableItem).toggle("flipY"),e.drawCanvas()},e.flipVertical=function(){e.canvas.item(e.editableItem).toggle("flipX"),e.drawCanvas()},e.setHorizontalCenter=function(){e.canvas.item(e.editableItem).centerH(),e.drawCanvas()},e.setVerticalCenter=function(){e.canvas.item(e.editableItem).centerV(),e.drawCanvas()},e.init=function(){e.colors=[],e.original_colors=[],"path-group"==e.editable.type&&(e.original_colors=angular.isUndefined(e.editable.original_colors)||null==e.editable.original_colors?{}:e.editable.original_colors,_.each(e.editable.paths,function(t,a){if(angular.isUndefined(e.original_colors[a])&&(e.original_colors[a]={},e.original_colors[a].fill=t.fill),angular.isUndefined(t.fill.type)&&-1===$.inArray(t.fill,e.colors)&&"#"==t.fill.charAt(0)){var n=e.original_colors[a].fill;_.find(e.colors,{original:n})||e.colors.push({original:n,replacement:t.fill})}e.editable.original_colors=e.original_colors}))}}]),angular.module("app").controller("ImagesGraphicsController",["$scope","$location","$urlRouter","$stateParams","$http","$timeout","ApiService","$state",function(e,t,a,n,o,i,r,c){this.name="ImagesGraphicsController",this.params=n,e._=_,e.clipArt=null,e.categories=null,window.scope=e,e.setActiveTab("images"),e.addClipart=function(t){console.log("img",t),fabric.loadSVGFromURL(e.clipArtImage(t),function(t,a){e.canvas.add(new fabric.PathGroup(t,a).set({left:100,top:100})),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1));var n=.9*e.canvas.width,o=.9*e.canvas.height,i=n;a.width<n&&(i=a.width);var r=i/a.width,s=a.height*r;if(console.log("still too big"),s>o){s=o;var l=s/a.height;i=a.width*l}var d=getBorderColor(_.first(e.currentItem.variant.colors));if("#FFFFFF"==d){var u=e.canvas.getActiveObject();_.each(u.paths,function(e){angular.isUndefined(e.fill.type)&&"#000000"==e.fill&&(e.fill="#FFFFFF")}),e.canvas.item(u)}e.canvas.getActiveObject().set({scaleX:i/a.width,scaleY:s/a.height}).center().setCoords(),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1)),e.drawCanvas(),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1)),e.drawCanvas(),e.isMobile&&(c.go("app.product.home"),e.showMobileDesigner())})},e.setCategory=function(t){e.selectedCategory=t},e.clipArtImage=function(e){return r.Url(e.path)},e.loadClipArt=function(){var t=r.Url("clip_art.php");o({method:"GET",url:t,cache:!1}).success(function(t){e.clipArt=t,e.categories=_.uniq(_.pluck(e.clipArt,"category")),e.selectedCategory=_.first(e.categories)}).error(function(){})},e.loadClipArt(),e.init=function(){},e.init(),e.updateColors=function(){_.each(e.editable.original_colors,function(t,a){var n=_.find(e.colors,{original:t.fill});n&&null!=n.replacement&&(console.log("updateColors",e.editable.paths[a].fill,n.replacement),e.editable.paths[a].fill=n.replacement)});var t=e.canvas.item(e.editableItem);null!=t&&(t.set("paths",e.editable.paths),t.original_colors=e.original_colors),e.drawCanvas()},e.switchColor=function(t,a){t.replacement=a,e.updateColors()}}]),angular.module("app").controller("ImagesUploadController",["$scope","$location","$urlRouter","$stateParams","$http","$upload","$timeout","ApiService",function(e,t,a,n,o,i,r,c){this.name="ImagesUploadController",this.params=n,e._=_,e.progress=0,e.file=null,e.src=null,e.whitespace=0,e.error=!1,e.setActiveTab("images"),e.humanFileSize=function(e){e=parseInt(e);var t=1024;if(t>e)return e+" B";var a=["kB","MB","GB","TB","PB","EB","ZB","YB"],n=-1;do e/=t,++n;while(e>=t);return e.toFixed(1)+" "+a[n]},e.onFileSelect=function(t){if(console.log(t),e.error=!1,e.progress=0,t.length>1)return void(e.error="Please upload only one item at a time!");e.src="css/images/loading_blank.gif";for(var a=0;a<t.length;a++)if(-1!==t[a].type.indexOf("image")){e.file=t[a];var n=new FileReader;n.readAsDataURL(t[a]);{(function(t){t.onload=function(t){r(function(){e.src=t.target.result})}})(n,a)}}else e.error="Only images are allowed"},e.startUpload=function(){e.progress=1,console.log("$scope.whitespace",e.whitespace),e.upload=i.upload({url:c.Url("upload.php"),method:"POST",withCredentials:!0,data:{whitespace:e.whitespace},fields:{whitespace:e.whitespace},file:e.file}).progress(function(t){e.progress=parseInt(100*t.loaded/t.total)}).success(function(t){e.addImage(e.uploadURL(t.filepath)),e.file=null})},e.setWhiteSpace=function(t){e.whitespace=t,console.log("setWhiteSpace",e.whitespace)},e.init=function(){},e.init()}]),angular.module("app").controller("ProductBrowserController",["$scope","$location","$urlRouter","$stateParams","$modalInstance","ProductService","ApiService","CartService","PriceService",function(e,t,a,n,o,i,r,c,s){this.name="ProductBrowserController",this.params=n,window.scope=e,e.text="ProductBrowserController",e.categories=null,e.selectedCategory=null,e.products=null,e.money=s,e.selectedProduct=null,e.catalog=null,e.imageUrl=function(e){return r.imageUrl(e)},e.dismiss=function(){e.$dismiss()},e.save=function(){item.update().then(function(){e.$close(!0)})},e.setSelectedVariant=function(t){e.selectedVariant=t},e.confirmProduct=function(){var a="product/selection/"+e.selectedProduct.slug+"/"+e.selectedVariant.slug;t.path(a),e.$dismiss()},e.selectProduct=function(t){e.selectedProduct=t,console.log(t.variants,t.defaultVariant,_.find(t.variants,{name:t.defaultVariant})),e.setSelectedVariant(_.find(t.variants,{name:t.defaultVariant}))},e.selectCategory=function(t){e.selectedCategory=t,e.products=_.where(e.catalog,{category:t.name}),e.selectProduct(e.products[0])},e.getProducts=function(){i.getProducts().then(function(t){e.categories=t.categories,e.catalog=t.products;var a=(c.getSelectedItem(),_.first(e.categories)),n=_.find(t.products,{category:a.name});console.log(a.name,n),e.selectCategory(a),e.selectProduct(n)})},e.init=function(){e.getProducts()},e.init()}]),angular.module("app").controller("ProductController",["$scope","$location","$urlRouter","$stateParams","ApiService","ProductService","CartService",function(e,t,a,n,o,i,r){this.name="ProductController",this.params=n,window.scope=e,e.setActiveTab("product"),e.setSelectedVariant=function(t){r.updateItem(e.currentItem.product,t,r.selectedItemId),e.selectedVariant=t,e.borderColor=getBorderColor(_.first(e.currentItem.variant.colors)),$("#designer-container").data("border",e.borderColor)},e.init=function(){},e.init()}]),angular.module("app").controller("ProductSelectionController",["$scope","$location","$urlRouter","$stateParams","$http","ApiService","ProductService","$state","CartService",function(e,t,a,n,o,i,r,c,s){this.name="ProductSelectionController",e.setActiveTab("product"),e.selectProduct=function(){r.getProducts().then(function(t){var a=_.find(t.products,{slug:n.productSlug}),o=_.find(a.variants,{slug:n.variantSlug});s.updateItem(a,o,s.selectedItemId),r.setOrientation(_.findKey(e.currentItem.variant.orientations)),e.setOrientation(_.findKey(e.currentItem.variant.orientations)),console.log("CHANGE FRAME"),e.updateOrientation(),e.borderColor=getBorderColor(_.first(e.currentItem.variant.colors)),$("#designer-container").data("border",e.borderColor),_.each(e.currentItem.variant.orientations,function(t,a){var n=e.imageUrl({product:e.currentItem.product.slug,w:e.designerWidth,h:e.designerHeight,variant:e.currentItem.variant.slug,orientation:a}),o=new Image;o.src=n}),c.go("app.product.home")})},e.$watch("isReady",function(){e.isReady&&e.selectProduct()}),e.init=function(){e.isReady&&e.selectProduct()},e.init()}]),angular.module("app").controller("TextController",["$scope","$location","$urlRouter","$stateParams","$state","$timeout","$http","ApiService","$interval","FontService",function(e,t,a,n,o,i,r,c,s,l){this.name="TextController",this.params=n,e.addText="",window.scope=e,e._=_,e.fonts=[],e.FontService=l,e.fontCategories=[],e.selectedFontCategory="Display",e.selectedFont=[],e.fontSelectionWindow=!1,e.setActiveTab("text"),e.$watch("isReady",function(){e.loadFonts()}),e.setSelectedFont=function(t){e.selectedFont=t,e.hideFontSelector()},e.showFontSelector=function(){e.fontSelectionWindow=!0},e.hideFontSelector=function(){e.fontSelectionWindow=!1},e.loadFonts=function(){e.fonts=l.fontList,e.fontCategories=l.fontCategories,e.selectedFont=_.findWhere(window.scope.fonts,{name:e.defaultFont})},e.font_image=function(e){return c.fontUrl(e)},e.add_text=function(){l.loadFont(e.selectedFont);var t=getBorderColor(_.first(e.currentItem.variant.colors)),a=new fabric.Text(e.addText,{left:100,top:10,fill:t,fontFamily:e.selectedFont.regular.fontface,radius:0,fontSize:50,textAlign:"center",spacing:0});e.canvas.add(a),e.canvas.setActiveObject(e.canvas.item(e.canvas.getObjects().length-1)),e.canvas.item(e.editableItem).centerH(),console.log(e.selectedFont.regular.fontface,isFontAvailable(e.selectedFont.regular.fontface));var n=s(function(){if(isFontAvailable(e.selectedFont.regular.fontface)){var t=e.canvas.item(e.editableItem);t.setFontFamily(e.selectedFont.regular.fontface),t.set("fontName",e.selectedFont.name),e.defaultFont=e.selectedFont.name;var a=.9*e.canvas.width,i=(.9*e.canvas.height,a);t.getWidth()<a&&(i=t.getWidth());var r=i/t.getWidth(),c=t.fontSize*r;t.setFontSize(parseInt(c,10)),t.setScaleX(1),t.setScaleY(1),t.centerH(),e.editable.fontSize=t.fontSize,e.drawCanvas(),s.cancel(n),e.isMobile&&(e.editMode="text",o.go("app.product.home"),e.showMobileDesigner())}},100);e.drawCanvas()},e.setFontCategory=function(t){e.selectedFontCategory=t}}]),angular.module("app").controller("TextEditController",["$scope","$location","$urlRouter","$stateParams","$state","$timeout","ApiService","$http","$interval","FontService",function(e,t,a,n,o,i,r,c,s,l){this.name="TextEditController",this.params=n,e.currentText="",e.item,window.textScope=e,e.setActiveTab("text"),e.eventColors=[{name:"Black",value:"#000000"},{name:"Green",value:"#7bd148"},{name:"BoldBlue",value:"#5484ed"},{name:"Blue",value:"#a4bdfc"},{name:"Turquoise",value:"#46d6db"},{name:"LightGreen",value:"#7ae7bf"},{name:"BoldGreen",value:"#51b749"},{name:"Yellow",value:"#fbd75b"},{name:"Orange",value:"#ffb878"},{name:"Red",value:"#ff887c"},{name:"BoldRed",value:"#dc2127"},{name:"Purple",value:"#dbadff"},{name:"Gray",value:"#e1e1e1"}],e.palette=[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],e.selectedColor=e.eventColors[0],e.strokeColor=e.eventColors[1],e.angle=0,e.fontSize=12,e.outline=!1,e.spinnerExample=20,e._=_,e.selectedFontCategory="Display",e.radius=50,e.fontSize=20,e.spacing=0,e.strokeWidth=20,e.$watch("isReady",function(){e.loadFonts()}),e.$watch("editableItem",function(){if(console.log("editableItem - TEXT",e.editableItem),null!=e.editableItem){var t=e.canvas.item(e.editableItem);("i-text"==t.type||"text"==t.type)&&e.init()}}),e.setFontCategory=function(t){e.selectedFontCategory=t},e.flipHorizontal=function(){e.canvas.item(e.editableItem).toggle("flipY"),e.drawCanvas()},e.flipVertical=function(){e.canvas.item(e.editableItem).toggle("flipX"),e.drawCanvas()},e.setHorizontalCenter=function(){e.canvas.item(e.editableItem).centerH(),e.drawCanvas()},e.setVerticalCenter=function(){e.canvas.item(e.editableItem).centerV(),e.drawCanvas()},e.toggleBold=function(){e.editable.bold?(e.editable.bold=!1,e.canvas.item(e.editableItem).setFontWeight("normal")):(e.editable.bold=!0,e.canvas.item(e.editableItem).setFontWeight("bold")),e.drawCanvas()},e.toggleItalic=function(){e.editable.italic?(e.editable.italic=!1,e.canvas.item(e.editableItem).setFontStyle("normal")):(e.editable.italic=!0,e.canvas.item(e.editableItem).setFontStyle("italic")),e.drawCanvas()},e.changeStroke=function(){0==e.outline&&(e.editable.stroke=null),e.canvas.item(e.editableItem).setStroke(e.editable.stroke);var t=e.editable.strokeWidth/100;t=5*t,console.log("changeStroke",e.editable.stroke,t),e.canvas.item(e.editableItem).setStrokeWidth(t),e.drawCanvas()},e.changeFill=function(t){e.canvas.item(e.editableItem).setFill(t),e.drawCanvas()},e.changeText=function(){e.canvas.item(e.editableItem).setText(e.editable.text),e.drawCanvas()},e.changeFontSize=function(){e.canvas.item(e.editableItem).setFontSize(e.editable.fontSize),e.drawCanvas()},e.align=function(t){e.editable.textAlign=t,e.canvas.item(e.editableItem).setTextAlign(t),e.drawCanvas()},e.setSelectedFont=function(t){e.selectedFont=t,l.loadFont(e.selectedFont),e.canvas.item(e.editableItem).setFontFamily(e.selectedFont.regular.fontface),e.canvas.item(e.editableItem).set("fontName",e.selectedFont.name);var a=s(function(){console.log(e.selectedFont.regular.fontface,isFontAvailable(e.selectedFont.regular.fontface)),isFontAvailable(e.selectedFont.regular.fontface)&&(e.canvas.item(e.editableItem).setFontFamily(e.selectedFont.regular.fontface),e.canvas.item(e.editableItem).set("fontName",e.selectedFont.name),e.drawCanvas(),s.cancel(a))},100);e.drawCanvas(),e.hideFontSelector()},e.showFontSelector=function(){e.selectedFont&&(e.selectedFontCategory=e.selectedFont.category),e.fontSelectionWindow=!0},e.hideFontSelector=function(){e.fontSelectionWindow=!1},e.loadFonts=function(){e.fonts=l.fontList,e.fontCategories=l.fontCategories,e.selectedFont=_.findWhere(window.scope.fonts,{name:e.defaultFont})},e.font_image=function(e){return r.fontUrl(e)},e.init=function(){var t=s(function(){var a=e.canvas.item(scope.editableItem).get("fontName");angular.isUndefined(a)||(e.selectedFont=_.findWhere(e.fonts,{name:a}),s.cancel(t))},100);null!=e.editable.stroke&&(e.outline=!0)}}]),angular.module("app").factory("ApiService",function(){return{baseUrl:function(){return window.location.host.indexOf("localhost:")>-1?"http://localhost/apps/tshirt_test/":"../"},Url:function(e){return this.baseUrl()+"api/"+e},fontUrl:function(e){return this.baseUrl()+"data/"+e},imageUrl:function(e){return this.baseUrl()+"api/image.php?"+$.param(e)},imageTransparentUrl:function(e){return this.baseUrl()+"api/image_transparent.php?"+$.param(e)},uploadURL:function(e){return this.baseUrl()+"storage/uploads/"+e}}}),angular.module("app").service("CanvasService",["localStorageService",function(e){this.orientations={},this.orientation_canvases={},this.orientation_data={},this.init=function(){var t=e.get("orientations");t&&(this.orientations=t);var a=e.get("orientation_data");null!=a&&(this.orientation_data=a)},this.setOrientationDesign=function(t,a){this.orientations[t]=a.toJSON(["original_colors","fontName"]),this.orientation_canvases[t]=a,e.set("orientations",this.orientations),e.set("orientation_canvases",this.orientation_canvases)},this.generateOrientationImage=function(t,a){if(this.orientation_data[t]={},this.orientation_data[t].background=a.background,this.orientation_data[t].offset_x=a.offset_x,this.orientation_data[t].offset_y=a.offset_y,this.orientation_data[t].image_width=a.image_width,this.orientation_data[t].image_height=a.image_height,this.orientation_data[t].background_width=a.background_width,this.orientation_data[t].background_height=a.background_height,angular.isDefined(this.orientation_canvases[t])){var n=this.orientation_canvases[t];this.orientation_data[t].image=n.deactivateAll().toDataURL()}else this.orientation_data[t].image=null;e.set("orientation_data",this.orientation_data)},this.getOrientationDesign=function(e){return this.orientations[e]},this.getOrientationImage=function(e){return this.orientation_data[e]},this.getOrientationData=function(){return this.orientation_data},this.init()}]),angular.module("app").service("CartService",["localStorageService","PriceService",function(e,t){this.cart=[],this.cumulativeCount=0,this.itemId=0,this.selectedItemId=0,this.init=function(){var t=e.get("cart.items");this.cart=t?t:[];var a=e.get("cart.selectedItemId");this.selectedItemId=a?a:0,this.cumulativeCount=this.cart.length},this.reset=function(){e.remove("cart.items"),e.remove("cart.selectedItemId"),this.init()},this.setSelectedItem=function(t){this.selectedItemId=t,e.set("cart.selectedItemId",this.selectedItemId)},this.getSelectedItem=function(){var t=e.get("cart.selectedItemId");if(!t)return!1;this.selectedItemId=t;var a=_.find(this.cart,{id:this.selectedItemId});return a},this.updateItem=function(e,t,a){this.itemId=a;var n=_.find(this.cart,{id:this.itemId});n.id=this.itemId,n.product=e,n.variant=t,n.orientations={},n.price=t.price,n.single_price=t.price,n.quantities={},_.each(e.sizes,function(e){n.quantities[e]=0}),n.total_quantity=_.reduce(this.quantities,function(e,t){return t=parseInt(t),e+t},0),n.total_price=n.single_price*n.total_quantity,this.insert(n),this.setSelectedItem(this.itemId)},this.updateItemCanvas=function(t,a,n){this.itemId=n;var o=_.find(this.cart,{id:this.itemId});o.canvases[t]=a.toJSON(["original_colors","fontName"]),a.clone(function(e){var a=e;o.images[t]=a.toDataURL()}),o.layers=this.calculateLayers(o),o.single_price=this.calculateSinglePrice(o,o.layers.colors),o.total_quantity=_.reduce(this.quantities,function(e,t){return t=parseInt(t),e+t
},0),o.total_price=o.single_price*o.total_quantity,this.insert(o),e.set("cart.items",this.cart)},this.calculateLayers=function(e){var t={};return t.orientations=_.size(e.variant.orientations),t.orientations_designed=0,t.orientations_layers=[],t.colors={},_.each(e.variant.orientations,function(a,n){t.colors[n]=0;var o=e.canvases[n],i={};if(t.orientations_designed=t.orientations_designed+1,i.name=n,angular.isUndefined(o))i.colors=0,i.count=0,i.photos=0,i.text=0,i.graphics=0,i.fills=[],t.colors[n]=0;else{i.count=o.objects.length,i.photos=_.size(_.where(o.objects,{type:"image"})),i.text=_.size(_.where(o.objects,{type:"i-text"})),i.graphics=_.size(_.where(o.objects,{type:"path-group"}));var r=[];_.each(o.objects,function(e){"path-group"==e.type&&_.each(e.paths,function(e){"#"==e.fill.charAt(0)&&(e.fill&&r.push(e.fill),e.stroke&&r.push(e.stroke))}),("i-text"===e.type||"text"===e.type)&&_.each(e.paths,function(){e.fill&&r.push(e.fill),e.stroke&&r.push(e.stroke)}),"image"===e.type&&r.push("INF")}),i.fills=_.uniq(r),t.colors[n]=_.size(i.fills),_.contains(r,"INF")&&(t.colors[n]="INF")}t.orientations_layers.push(i)}),t},this.calculateSinglePrice=function(e){var t=parseFloat(e.variant.price);return t+=this._calculateLayerCost(e)},this._parseTextLayer=function(e){var t=[];return t.push(e.fill),t.push(e.stroke),t},this._parseGraphicLayer=function(e){var t=[];return _.each(e.paths,function(e){t.push(e.fill),t.push(e.stroke)}),t},this._cleanColors=function(e){e=_.unique(e);var t=[];return _.each(e,function(e){e&&"#"==e.charAt(0)&&t.push(e)}),t},this._calculateOrientationPrice=function(e,a){var n=t.pricing,o=_.size(e),i=_.size(n);(o>i||a)&&(o="INF");var r=0;return _.isUndefined(n[o])||(r=parseFloat(n[o])),parseFloat(r)},this._calculateLayerCost=function(e){var a={},n={},o=this,i=t.charges_per_side;_.each(e.canvases,function(e,t){a[t]=[];var i=!1;_.each(e.objects,function(e){(_.isEqual(e.type,"text")||_.isEqual(e.type,"i-text"))&&(a[t]=a[t].concat(o._parseTextLayer(e))),_.isEqual(e.type,"path-group")&&(a[t]=a[t].concat(o._parseGraphicLayer(e))),_.isEqual(e.type,"image")&&(i=!0)}),a[t]=o._cleanColors(a[t]),n[t]=o._calculateOrientationPrice(a[t],i)});var r=_.reduce(_.values(n),function(e,t){return e+t},0),c=_.reduce(_.values(a),function(e,t){var a=_.size(t)>0?1:0;return e+a},0),s=_.find(i,{sides:c});return _.isUndefined(s)||(r+=s.price),r},this.sumQuantities=function(t){e.set("cart.items",this.cart);var a=_.reduce(t,function(e,t){return t=parseInt(t),e+t},0);return a},this.sumPrice=function(e,a){var n=this.sumQuantities(e);a=accounting.unformat(a);var o=a*n,i=0;if(_.each(t.bulk_discounts,function(e){var t="INF"==e.to?Number.POSITIVE_INFINITY:parseInt(e.to);n>=parseInt(e.from)&&t>=n&&(i=parseFloat(e.discount))}),i>0){var r=o*(i/100);o-=r}return o},this.sumTotalPrice=function(){var e=0,t=this;return _.each(this.cart,function(a){a.total_quantity=_.reduce(a.quantities,function(e,t){return t=parseInt(t),e+t},0),a.total_price=t.sumPrice(a.quantities,a.single_price),a.discount_price=a.total_price/a.total_quantity,e+=a.total_price}),e},this.generateUUID=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?a:3&a|8).toString(16)});return t},this.newItem=function(e,t){this.itemId=this.generateUUID();var a={};return a.id=this.itemId,a.product=e,a.variant=t,a.orientations={},a.price=t.price,a.single_price=t.price,a.total_price=0,a.total_quantity=0,a.canvases={},a.images={},a.layers={},a.quantities={},_.each(e.sizes,function(e){a.quantities[e]=0}),this.insert(a),this.setSelectedItem(this.itemId),a},this.duplicateItem=function(e){this.itemId=(new Date).getUTCMilliseconds();var t=jQuery.extend(!0,{},e);return t.id=this.itemId,this.insert(t),this.setSelectedItem(this.itemId),t},this.insert=function(t){var a=_.find(this.cart,{id:t.id});if(a){var n=_.indexOf(this.cart,a);this.cart[n]=_.extend(this.cart[n],t)}else this.cart.push({id:t.id,product:t.product,variant:t.variant,orientations:t.orientations,quantities:t.quantities,canvases:t.canvases,images:t.images,price:t.price,single_price:t.single_price,total_price:t.total_price,total_quantity:t.total_quantity}),this.cumulativeCount+=1;e.set("cart.items",this.cart)},this.update=function(){},this.remove=function(t){if(this.cart=_.without(this.cart,_.findWhere(this.cart,{id:t})),e.set("cart.items",this.cart),this.selectedItemId==t){var a=_.first(this.cart);a&&this.setSelectedItem(a.id)}},this.destroy=function(){},this.totalItems=function(){},this.getTotalPrice=function(){return 20},this.getItems=function(){return this.cart},this.init()}]),angular.module("countrySelect",[]).directive("countrySelect",["$parse",function(e){var t=[{code:"af",name:"Afghanistan"},{code:"ax",name:"Åland Islands"},{code:"al",name:"Albania"},{code:"dz",name:"Algeria"},{code:"as",name:"American Samoa"},{code:"ad",name:"Andorra"},{code:"ao",name:"Angola"},{code:"ai",name:"Anguilla"},{code:"aq",name:"Antarctica"},{code:"ag",name:"Antigua and Barbuda"},{code:"ar",name:"Argentina"},{code:"am",name:"Armenia"},{code:"aw",name:"Aruba"},{code:"au",name:"Australia"},{code:"at",name:"Austria"},{code:"az",name:"Azerbaijan"},{code:"bs",name:"Bahamas"},{code:"bh",name:"Bahrain"},{code:"bd",name:"Bangladesh"},{code:"bb",name:"Barbados"},{code:"by",name:"Belarus"},{code:"be",name:"Belgium"},{code:"bz",name:"Belize"},{code:"bj",name:"Benin"},{code:"bm",name:"Bermuda"},{code:"bt",name:"Bhutan"},{code:"bo",name:"Bolivia, Plurinational State of"},{code:"bq",name:"Bonaire, Sint Eustatius and Saba"},{code:"ba",name:"Bosnia and Herzegovina"},{code:"bw",name:"Botswana"},{code:"bv",name:"Bouvet Island"},{code:"br",name:"Brazil"},{code:"io",name:"British Indian Ocean Territory"},{code:"bn",name:"Brunei Darussalam"},{code:"bg",name:"Bulgaria"},{code:"bf",name:"Burkina Faso"},{code:"bi",name:"Burundi"},{code:"kh",name:"Cambodia"},{code:"cm",name:"Cameroon"},{code:"ca",name:"Canada"},{code:"cv",name:"Cape Verde"},{code:"ky",name:"Cayman Islands"},{code:"cf",name:"Central African Republic"},{code:"td",name:"Chad"},{code:"cl",name:"Chile"},{code:"cn",name:"China"},{code:"cx",name:"Christmas Island"},{code:"cc",name:"Cocos (Keeling) Islands"},{code:"co",name:"Colombia"},{code:"km",name:"Comoros"},{code:"cg",name:"Congo"},{code:"cd",name:"Congo, the Democratic Republic of the"},{code:"ck",name:"Cook Islands"},{code:"cr",name:"Costa Rica"},{code:"ci",name:"Côte d'Ivoire"},{code:"hr",name:"Croatia"},{code:"cu",name:"Cuba"},{code:"cw",name:"Curaçao"},{code:"cy",name:"Cyprus"},{code:"cz",name:"Czech Republic"},{code:"dk",name:"Denmark"},{code:"dj",name:"Djibouti"},{code:"dm",name:"Dominica"},{code:"do",name:"Dominican Republic"},{code:"ec",name:"Ecuador"},{code:"eg",name:"Egypt"},{code:"sv",name:"El Salvador"},{code:"gq",name:"Equatorial Guinea"},{code:"er",name:"Eritrea"},{code:"ee",name:"Estonia"},{code:"et",name:"Ethiopia"},{code:"fk",name:"Falkland Islands (Malvinas)"},{code:"fo",name:"Faroe Islands"},{code:"fj",name:"Fiji"},{code:"fi",name:"Finland"},{code:"fr",name:"France"},{code:"gf",name:"French Guiana"},{code:"pf",name:"French Polynesia"},{code:"tf",name:"French Southern Territories"},{code:"ga",name:"Gabon"},{code:"gm",name:"Gambia"},{code:"ge",name:"Georgia"},{code:"de",name:"Germany"},{code:"gh",name:"Ghana"},{code:"gi",name:"Gibraltar"},{code:"gr",name:"Greece"},{code:"gl",name:"Greenland"},{code:"gd",name:"Grenada"},{code:"gp",name:"Guadeloupe"},{code:"gu",name:"Guam"},{code:"gt",name:"Guatemala"},{code:"gg",name:"Guernsey"},{code:"gn",name:"Guinea"},{code:"gw",name:"Guinea-Bissau"},{code:"gy",name:"Guyana"},{code:"ht",name:"Haiti"},{code:"hm",name:"Heard Island and McDonald Islands"},{code:"va",name:"Holy See (Vatican City State)"},{code:"hn",name:"Honduras"},{code:"hk",name:"Hong Kong"},{code:"hu",name:"Hungary"},{code:"is",name:"Iceland"},{code:"in",name:"India"},{code:"id",name:"Indonesia"},{code:"ir",name:"Iran, Islamic Republic of"},{code:"iq",name:"Iraq"},{code:"ie",name:"Ireland"},{code:"im",name:"Isle of Man"},{code:"il",name:"Israel"},{code:"it",name:"Italy"},{code:"jm",name:"Jamaica"},{code:"jp",name:"Japan"},{code:"je",name:"Jersey"},{code:"jo",name:"Jordan"},{code:"kz",name:"Kazakhstan"},{code:"ke",name:"Kenya"},{code:"ki",name:"Kiribati"},{code:"kp",name:"Korea, Democratic People's Republic of"},{code:"kr",name:"Korea, Republic of"},{code:"kw",name:"Kuwait"},{code:"kg",name:"Kyrgyzstan"},{code:"la",name:"Lao People's Democratic Republic"},{code:"lv",name:"Latvia"},{code:"lb",name:"Lebanon"},{code:"ls",name:"Lesotho"},{code:"lr",name:"Liberia"},{code:"ly",name:"Libya"},{code:"li",name:"Liechtenstein"},{code:"lt",name:"Lithuania"},{code:"lu",name:"Luxembourg"},{code:"mo",name:"Macao"},{code:"mk",name:"Macedonia, the former Yugoslav Republic of"},{code:"mg",name:"Madagascar"},{code:"mw",name:"Malawi"},{code:"my",name:"Malaysia"},{code:"mv",name:"Maldives"},{code:"ml",name:"Mali"},{code:"mt",name:"Malta"},{code:"mh",name:"Marshall Islands"},{code:"mq",name:"Martinique"},{code:"mr",name:"Mauritania"},{code:"mu",name:"Mauritius"},{code:"yt",name:"Mayotte"},{code:"mx",name:"Mexico"},{code:"fm",name:"Micronesia, Federated States of"},{code:"md",name:"Moldova, Republic of"},{code:"mc",name:"Monaco"},{code:"mn",name:"Mongolia"},{code:"me",name:"Montenegro"},{code:"ms",name:"Montserrat"},{code:"ma",name:"Morocco"},{code:"mz",name:"Mozambique"},{code:"mm",name:"Myanmar"},{code:"na",name:"Namibia"},{code:"nr",name:"Nauru"},{code:"np",name:"Nepal"},{code:"nl",name:"Netherlands"},{code:"nc",name:"New Caledonia"},{code:"nz",name:"New Zealand"},{code:"ni",name:"Nicaragua"},{code:"ne",name:"Niger"},{code:"ng",name:"Nigeria"},{code:"nu",name:"Niue"},{code:"nf",name:"Norfolk Island"},{code:"mp",name:"Northern Mariana Islands"},{code:"no",name:"Norway"},{code:"om",name:"Oman"},{code:"pk",name:"Pakistan"},{code:"pw",name:"Palau"},{code:"ps",name:"Palestine, State of"},{code:"pa",name:"Panama"},{code:"pg",name:"Papua New Guinea"},{code:"py",name:"Paraguay"},{code:"pe",name:"Peru"},{code:"ph",name:"Philippines"},{code:"pn",name:"Pitcairn"},{code:"pl",name:"Poland"},{code:"pt",name:"Portugal"},{code:"pr",name:"Puerto Rico"},{code:"qa",name:"Qatar"},{code:"re",name:"Réunion"},{code:"ro",name:"Romania"},{code:"ru",name:"Russian Federation"},{code:"rw",name:"Rwanda"},{code:"bl",name:"Saint Barthélemy"},{code:"sh",name:"Saint Helena, Ascension and Tristan da Cunha"},{code:"kn",name:"Saint Kitts and Nevis"},{code:"lc",name:"Saint Lucia"},{code:"mf",name:"Saint Martin (French part)"},{code:"pm",name:"Saint Pierre and Miquelon"},{code:"vc",name:"Saint Vincent and the Grenadines"},{code:"ws",name:"Samoa"},{code:"sm",name:"San Marino"},{code:"st",name:"Sao Tome and Principe"},{code:"sa",name:"Saudi Arabia"},{code:"sn",name:"Senegal"},{code:"rs",name:"Serbia"},{code:"sc",name:"Seychelles"},{code:"sl",name:"Sierra Leone"},{code:"sg",name:"Singapore"},{code:"sx",name:"Sint Maarten (Dutch part)"},{code:"sk",name:"Slovakia"},{code:"si",name:"Slovenia"},{code:"sb",name:"Solomon Islands"},{code:"so",name:"Somalia"},{code:"za",name:"South Africa"},{code:"gs",name:"South Georgia and the South Sandwich Islands"},{code:"ss",name:"South Sudan"},{code:"es",name:"Spain"},{code:"lk",name:"Sri Lanka"},{code:"sd",name:"Sudan"},{code:"sr",name:"Suriname"},{code:"sj",name:"Svalbard and Jan Mayen"},{code:"sz",name:"Swaziland"},{code:"se",name:"Sweden"},{code:"ch",name:"Switzerland"},{code:"sy",name:"Syrian Arab Republic"},{code:"tw",name:"Taiwan, Province of China"},{code:"tj",name:"Tajikistan"},{code:"tz",name:"Tanzania, United Republic of"},{code:"th",name:"Thailand"},{code:"tl",name:"Timor-Leste"},{code:"tg",name:"Togo"},{code:"tk",name:"Tokelau"},{code:"to",name:"Tonga"},{code:"tt",name:"Trinidad and Tobago"},{code:"tn",name:"Tunisia"},{code:"tr",name:"Turkey"},{code:"tm",name:"Turkmenistan"},{code:"tc",name:"Turks and Caicos Islands"},{code:"tv",name:"Tuvalu"},{code:"ug",name:"Uganda"},{code:"ua",name:"Ukraine"},{code:"ae",name:"United Arab Emirates"},{code:"gb",name:"United Kingdom"},{code:"us",name:"United States"},{code:"um",name:"United States Minor Outlying Islands"},{code:"uy",name:"Uruguay"},{code:"uz",name:"Uzbekistan"},{code:"vu",name:"Vanuatu"},{code:"ve",name:"Venezuela, Bolivarian Republic of"},{code:"vn",name:"Viet Nam"},{code:"vg",name:"Virgin Islands, British"},{code:"vi",name:"Virgin Islands, U.S."},{code:"wf",name:"Wallis and Futuna"},{code:"eh",name:"Western Sahara"},{code:"ye",name:"Yemen"},{code:"zm",name:"Zambia"},{code:"zw",name:"Zimbabwe"}];return{template:'<select ng-model="attrs.ngModel" ng-options="c.code as c.name for c in countries">',replace:!0,link:function(a,n,o){if(a.countries=t,o.ngModel){var i=e(o.ngModel).assign;n.bind("change",function(){i(n.val())}),a.$watch(o.ngModel,function(e){n.val(e)})}}}}]),angular.module("app").service("FontService",["localStorageService","ApiService","$q","$interval","$http",function(e,t,a,n,o){this.fonts={},this.fontList=[],this.fontCategories=[],this.init=function(){var t=e.get("fonts");t&&(this.fonts=t)},this.loadFont=function(a){isFontAvailable(a.regular.fontface)||$("head").append('<link rel="stylesheet" type="text/css" href="'+t.fontUrl(a.regular.stylesheet)+'">'),this.fonts[a.name]=a,e.set("fonts",this.fonts)},this.preloadFonts=function(){var e=this,o=a.defer();return _.each(e.fonts,function(a){if(!isFontAvailable(a.regular.fontface)){var o=_.find(e.fontList,{name:a.name});if(!angular.isUndefined(o)){$("head").append('<link rel="stylesheet" type="text/css" href="'+t.fontUrl(a.regular.stylesheet)+'">');var i=n(function(){isFontAvailable(a.regular.fontface)&&(canvas.renderAll(),n.cancel(i))},100)}}}),o.resolve(e.fonts),o.promise},this.getFonts=function(){var e=this,n=a.defer();return o({method:"GET",url:t.Url("fonts.php"),cache:!1}).success(function(t){e.fontList=t,e.fontCategories=_.uniq(_.pluck(e.fontList,"category")),n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.init()}]),angular.module("app").service("PriceService",["localStorageService","ApiService","$http","$q",function(e,t,a,n){this.currency_code="USD",this.currency_symbol="$",this.layers=null,this.delivery=!1,this.quantities=!1,this.price=0,this.pricing=null,this.deliveryTypes=null,this.charges_per_side=null,this.bulk_discounts=null,this.getPricing=function(){var e=this,o=n.defer();return a({method:"GET",url:t.Url("get_pricing.php"),cache:!1}).success(function(t){e.pricing=t.pricing,e.deliveryTypes=t.delivery_types,e.charges_per_side=t.charges_per_side,e.bulk_discounts=t.bulk_discounts,o.resolve(t)}).error(function(e){o.reject(e)}),o.promise},this.setPrice=function(t){e.set("checkout.price",t),this.price=t},this.setPostage=function(t){e.set("checkout.postage",t),this.postage=t},this.setPostageDescription=function(t){e.set("checkout.postage_description",t)},this.setQuantities=function(t){e.set("checkout.quantities",t),this.quantities=t},this.setTitle=function(t){e.set("checkout.title",t)},this.setDescription=function(t){e.set("checkout.description",t)},this.setDelivery=function(t){e.set("checkout.delivery",t),this.delivery=t},this.setLayers=function(t){e.set("checkout.layers",t),this.layers=t},this.getPrice=function(){var t=e.get("checkout.price");return null==t&&(t=0),t},this.getQuantities=function(){var t=e.get("checkout.quantities");return null==t&&(t={}),t},this.getDescription=function(){var t=e.get("checkout.description");return t},this.getTitle=function(){var t=e.get("checkout.title");return t},this.getTotalQuantity=function(){var e=this.getQuantities(),t=_.reduce(e,function(e,t){return t=parseInt(t),e+t},0);return t},this.getDelivery=function(){var t=e.get("checkout.delivery");return t},this.getPostageDescription=function(){var t=e.get("checkout.postage_description");return t},this.getPostage=function(){var t=e.get("checkout.postage");return null==t&&(t=0),t},this.setCurrency=function(e){this.currency_code=e},this.setCurrencySymbol=function(e){this.currency_symbol=e},this.getCurrency=function(){return this.currency_code},this.getCurrencySymbol=function(){return this.currency_symbol},this.getLayers=function(){var t=e.get("checkout.layers");return null==t&&(t={}),t},this.format=function(e){return accounting.formatMoney(e,this.getCurrencySymbol())}}]),angular.module("app").service("ProductService",["ApiService","$http","$q",function(e,t,a){this.categories=null,this.products=null,this.orientations=null,this.setOrientation=function(e){this.currentOrientation=e},this.getOrientation=function(){return this.currentOrientation},this.getOrientations=function(){return this.orientations},this.getProducts=function(){var n=this,o=a.defer();return t({method:"GET",url:e.Url("get_products.php"),cache:!0}).success(function(e){n.categories=e.categories,n.products=e.products,o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}]);